function Display(e,t,i){var n=this;this.value=e,this.text=t,this.multiSelect=i,this.element=createElement("div",{class:"item-display"}),this.text=createElement("span",{class:"item-text",innerText:t}),this.input=createElement("input",{type:"hidden",readonly:"readonly",value:e}),this.buttonRemove=createElement("button",{class:"remove-value",innerHTML:"-"}),this.element.appendChild(this.text),this.element.appendChild(this.input),this.element.appendChild(this.buttonRemove),this.buttonRemove.onclick=function(e){e.preventDefault(),n.multiSelect.removeValue(n.value)}}function MultiSelect(e,t,i,n){this.selectedOption=function(){return l.element.children[l.element.selectedIndex]},this.addValue=function(e){var t=e.value?e.value:e;if(-1==l.selectedValues.indexOf(t)){var i=!1;l.options.forEach(function(e){e.value==t&&(i=!0)}),i&&l.selectedValues.push(t)}l.update()},this.removeValue=function(e){var t=e.value?e.value:e,i=this.selectedValues.indexOf(t);-1!=i&&this.selectedValues.splice(i,1),l.update()},this.update=function(){l.options.forEach(function(e){var t=l.getChildrenOptions(function(t){return t.value==e.value}),i=[];if(l.displayItems.forEach(function(t,n){t.value==e.value&&i.push(t)}),-1==l.selectedValues.indexOf(e.value)){if(0==t.length){l.element.appendChild(e);var n=l.element.children.length-1,s=l.options.indexOf(e)+1;l.element.insertBefore(l.element.children[n],l.element.children[s])}if(i.length>0){var a=l.displayItems.indexOf(i[0]);l.displayItems.splice(a,1),l.display.removeChild(i[0].element)}}else if(t.length>0&&l.element.removeChild(t[0]),0==i.length){var r=l.getDisplayItem(e.value);r||(r=new Display(e.value,e.innerText?e.innerText:e.innerHTML,l),l.displayItems.push(r)),l.display.appendChild(r.element)}}),l.value=l.selectedValues.length?l.selectedValues.join(l.SEPARATOR):this.DEFAULT_VALUE,l.output.value=l.value,l.element.selectedIndex=0},this.getChildrenOptions=function(e){return filterChilds(this.element,e)},this.getChildrenDisplay=function(e){return filterChilds(this.display,e)},this.getDisplayItem=function(e){for(var t=0;t<l.displayItems.length;t++)if(l.displayItems[t].value==e)return l.displayItems[t];return!1};var l=this;this.DEFAULT_VALUE=i||"--NOVALUE--",this.SEPARATOR=";",this.element=e,this.initValues=this.element.getAttribute("data-init-values"),this.created=new Date,this.id="multiselect-"+(this.element.getAttribute("name")?this.element.getAttribute("name"):this.element.getAttribute("id")),this.wrapper=createElement("div",{class:"wrapper-multiselect"}),this.display=createElement("div",{class:"display"}),this.output=createElement("input",{type:"hidden",name:this.element.getAttribute("name"),value:this.DEFAULT_VALUE,id:this.element.getAttribute("id")}),this.selectWrapper=createElement("div",{class:"wrapper-select"}),this.buttonAdd=createElement("button",{class:"add-value",innerHTML:"+"}),this.selectedValues=this.initValues?this.initValues.split(this.SEPARATOR):[],this.options=this.getChildrenOptions(),this.displayItems=[],this.element.parentNode.insertBefore(this.wrapper,this.element),this.selectWrapper.appendChild(this.element),this.selectWrapper.appendChild(this.buttonAdd),this.wrapper.appendChild(this.output),this.wrapper.appendChild(this.display),this.wrapper.appendChild(this.selectWrapper),0!=n?this.element.insertBefore(createElement("option",{innerText:t||"Choose an option",value:this.DEFAULT_VALUE,selected:"selected"}),this.element.children[0]):this.getChildrenOptions(function(e){return e.value==l.DEFAULT_VALUE})[0].innerText=t,this.value=this.DEFAULT_VALUE,this.buttonAdd.onclick=function(e){e.preventDefault();var t=l.selectedOption();t.value&&t.value!=l.DEFAULT_VALUE&&l.addValue(t.value)},this.element.selectedIndex=0,this.element.value=this.DEFAULT_VALUE,this.element.setAttribute("name",this.id),this.element.setAttribute("id",this.id),this.update()}function createElement(e,t,i){var n=document.createElement(e);if(t)for(var l in t)t.hasOwnProperty(l)&&(void 0!==n[l]?n[l]=t[l]:n.setAttribute(l,t[l]));return"function"==typeof t?t(n):"function"==typeof i&&i(n),n}function forEach(e,t){return Array.prototype.forEach.call(e,t)}function filterChilds(e,t){var i=[];return forEach(e.children,function(e){"option"==e.tagName.toLowerCase()&&(t&&"function"==typeof t?t(e)&&i.push(e):i.push(e))}),i}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i;if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),l=n.length>>>0;if(0===l)return-1;if(i=+t||0,1/0===Math.abs(i)&&(i=0),i>=l)return-1;for(i=Math.max(0<=i?i:l-Math.abs(i),0);i<l;){if(i in n&&n[i]===e)return i;i++}return-1});
