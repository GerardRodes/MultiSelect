function Display(e,t,i){var n=this;this.value=e,this.text=t,this.multiSelect=i,this.element=createElement("div",{class:"item-display"}),this.text=createElement("span",{class:"item-text",innerText:t}),this.input=createElement("input",{type:"hidden",readonly:"readonly",value:e}),this.buttonRemove=createElement("button",{class:"remove-value",innerHTML:"-"}),this.element.appendChild(this.text),this.element.appendChild(this.input),this.element.appendChild(this.buttonRemove),this.buttonRemove.onclick=function(e){n.multiSelect.removeValue(n.value)}}function MultiSelect(e,t){this.selectedOption=function(){return i.element.children[i.element.selectedIndex]},this.addValue=function(e){var t=e.value?e.value:e;if(-1==i.selectedValues.indexOf(t)){var n=!1;i.options.forEach(function(e){e.value==t&&(n=!0)}),n&&i.selectedValues.push(t)}i.update()},this.removeValue=function(e){var t=e.value?e.value:e,n=this.selectedValues.indexOf(t);-1!=n&&this.selectedValues.splice(n,1),i.update()},this.update=function(){i.options.forEach(function(e){var t=i.getChildrenOptions(function(t){return t.value==e.value}),n=[];if(i.displayItems.forEach(function(t,i){t.value==e.value&&n.push(t)}),-1==i.selectedValues.indexOf(e.value)){if(0==t.length){i.element.appendChild(e);var l=i.element.children.length-1,s=i.options.indexOf(e)+1;i.element.insertBefore(i.element.children[l],i.element.children[s])}if(n.length>0){var a=i.displayItems.indexOf(n[0]);i.displayItems.splice(a,1),i.display.removeChild(n[0].element)}}else if(t.length>0&&i.element.removeChild(t[0]),0==n.length){var r=i.getDisplayItem(e.value);r||(r=new Display(e.value,e.innerText?e.innerText:e.innerHTML,i),i.displayItems.push(r)),i.display.appendChild(r.element)}}),i.value=i.selectedValues.join(";"),i.output.value=i.value,i.element.selectedIndex=0},this.getChildrenOptions=function(e){return filterChilds(this.element,e)},this.getChildrenDisplay=function(e){return filterChilds(this.display,e)},this.getDisplayItem=function(e){for(var t=0;t<i.displayItems.length;t++)if(i.displayItems[t].value==e)return i.displayItems[t];return!1};var i=this;this.element=e,this.created=new Date,this.id="multiselect-"+(this.element.getAttribute("name")?this.element.getAttribute("name"):this.element.getAttribute("id")),this.wrapper=createElement("div",{class:"wrapper-multiselect",id:this.id+"-output"}),this.display=createElement("div",{class:"display"}),this.output=createElement("input",{type:"hidden",name:this.id}),this.selectWrapper=createElement("div",{class:"wrapper-select"}),this.buttonAdd=createElement("button",{class:"add-value",innerHTML:"+"}),this.selectedValues=[],this.options=this.getChildrenOptions(),this.displayItems=[],this.element.parentNode.insertBefore(this.wrapper,this.element),this.selectWrapper.appendChild(this.element),this.selectWrapper.appendChild(this.buttonAdd),this.wrapper.appendChild(this.output),this.wrapper.appendChild(this.display),this.wrapper.appendChild(this.selectWrapper),this.element.insertBefore(createElement("option",{innerText:t||"Choose an option",value:""}),this.element.children[0]),this.value="",this.buttonAdd.onclick=function(e){var t=i.selectedOption();t.value&&""!=t.value&&i.addValue(t.value)},this.element.selectedIndex=0}function createElement(e,t,i){var n=document.createElement(e);if(t)for(var l in t)t.hasOwnProperty(l)&&(void 0!==n[l]?n[l]=t[l]:n.setAttribute(l,t[l]));return"function"==typeof t?t(n):"function"==typeof i&&i(n),n}function forEach(e,t){return Array.prototype.forEach.call(e,t)}function filterChilds(e,t){var i=[];return forEach(e.children,function(e){"option"==e.tagName.toLowerCase()&&(t&&"function"==typeof t?t(e)&&i.push(e):i.push(e))}),i}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i;if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),l=n.length>>>0;if(0===l)return-1;if(i=+t||0,1/0===Math.abs(i)&&(i=0),i>=l)return-1;for(i=Math.max(0<=i?i:l-Math.abs(i),0);i<l;){if(i in n&&n[i]===e)return i;i++}return-1});